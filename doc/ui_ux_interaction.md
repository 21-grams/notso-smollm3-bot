# UI/UX Interaction Documentation

## Overview

This document defines the user interaction flow and experience design for the SmolLM3 chat interface, featuring a minimalist neumorphic design with progressive enhancement through HTMX.

## Visual Design System

### Color Palette
- **Background**: `#e0e5ec` - Soft gray for neumorphic base
- **Text Primary**: `#2d3436` - Dark gray for main content
- **Text Secondary**: `#636e72` - Medium gray for secondary content
- **Accent**: `#5f27cd` - Deep purple for primary actions
- **Highlight**: `#00d2d3` - Cyan for notifications and special elements

### Neumorphic Effects
- **Raised Elements**: Dual shadows creating depth illusion
- **Pressed Elements**: Inset shadows for interactive states
- **Smooth Transitions**: 300ms ease for all state changes

## Core Interaction Flow

### 1. System Initialization & Greeting

**Trigger**: System startup complete, ML service ready

**User Experience**:
- Chat interface loads with greeting message
- System status badge shows "System Ready" with green indicator
- Input field is auto-focused for immediate interaction

**Technical Implementation**:
```html
<div class="message assistant">
    <div class="message-bubble">
        Hello! I'm SmolLM3, ready to help. How can I assist you today?
    </div>
</div>
```

### 2. Thinking Mode Toggle

**Location**: Above input field for easy access

**States**:
- **OFF (Default)**: Standard response generation
- **ON**: Activates `<think>` tokens for complex reasoning

**Visual Feedback**:
- Toggle switch with smooth slide animation
- Accent color when active
- Label changes color to indicate state

**Implementation**:
```html
<label class="thinking-toggle">
    <input type="checkbox" id="thinking-mode"
           hx-post="/api/toggle-thinking"
           hx-trigger="change">
    <span class="toggle-switch"></span>
    <span>Thinking Mode</span>
</label>
```

### 3. Message Submission

**User Action**: Type message and press Enter

**Flow**:
1. User types in input field
2. Presses Enter (or clicks Send)
3. Message immediately appears in chat (optimistic update)
4. Input field clears and refocuses
5. Status indicator shows "Sending..."

**HTMX Implementation**:
```html
<form hx-post="/api/chat"
      hx-target="#chat-messages"
      hx-swap="beforeend">
    <input type="text" name="message" required autofocus>
    <button type="submit">Send</button>
</form>
```

### 4. Response Streaming

**Server Behavior**: 
- Tokens generated by ML model
- Buffered in groups of 5-10 tokens
- Sent via SSE every 100ms

**User Experience**:
- Smooth text appearance
- No jarring updates
- Natural reading flow

**SSE Event Types**:
```javascript
// Token streaming
event: token
data: {"type": "token", "content": "Hello, "}

// Status updates
event: status
data: {"type": "status", "message": "Generating..."}

// Completion
event: complete
data: {"type": "complete", "follow_ups": [...]}
```

### 5. Response Completion

**Indicators**:
- Status indicator disappears
- Response stops streaming
- Follow-up suggestions appear

**Markdown Rendering**:
- All responses support full markdown
- Code blocks with syntax highlighting
- Lists, links, and formatting preserved

### 6. Follow-up Suggestions

**Display**: 3 contextual suggestions below each response

**Interaction**:
- Click to populate input field
- User can edit before sending
- Suggestions based on conversation context

**Example**:
```html
<div class="follow-up-actions">
    <button class="follow-up-btn">Tell me more about this</button>
    <button class="follow-up-btn">Can you provide an example?</button>
    <button class="follow-up-btn">What are the alternatives?</button>
</div>
```

### 7. Tool Usage Display

**When**: Bot automatically invokes tools as needed

**Visual Representation**:
```html
<div class="tool-use-display">
    <div class="tool-header">
        üîß Using Web Search...
    </div>
    <details class="tool-details">
        <summary>View details</summary>
        <div class="tool-content">
            <!-- Tool input/output -->
        </div>
    </details>
</div>
```

### 8. Status Display System

**Primary Status**: Floating pill above input field

**Status Types**:
- ü§î **Thinking**: When in thinking mode
- ‚úçÔ∏è **Generating**: During response generation
- üîß **Using [Tool]**: When invoking tools
- üîç **Searching**: During web search
- ‚öôÔ∏è **Processing**: General processing

**Expandable Details**:
- Click status pill to expand
- Shows detailed information
- Collapses automatically when done

**Implementation**:
```html
<div class="status-display" id="status-display">
    <span class="status-icon">ü§î</span>
    <span class="status-text">Thinking...</span>
    <details class="status-details">
        <summary>Details</summary>
        <div class="status-content">
            <!-- Detailed status information -->
        </div>
    </details>
</div>
```

### 9. Context Limit Indicator

**Location**: Below input field

**Visual Design**:
- Neumorphic progress bar
- Color-coded by usage level
- Numeric display (current/max tokens)

**Color States**:
- **Green** (0-70%): Normal usage
- **Yellow** (70-90%): Approaching limit
- **Red** (90-100%): Near capacity

**Implementation**:
```html
<div class="context-indicator">
    <div class="context-bar">
        <div class="context-fill" style="width: 45%"></div>
    </div>
    <span class="context-text">920 / 2048 tokens</span>
</div>
```

## Interaction States

### Input States
1. **Default**: Empty, placeholder visible
2. **Focused**: Border highlight with accent color
3. **Typing**: Real-time character count (optional)
4. **Submitting**: Disabled, loading indicator
5. **Submitted**: Cleared and refocused

### Message States
1. **Sending**: Appears immediately (optimistic)
2. **Sent**: Confirmed by server
3. **Failed**: Error state with retry option

### Response States
1. **Waiting**: Status indicator active
2. **Streaming**: Text appearing progressively
3. **Complete**: Full response with follow-ups
4. **Error**: Clear error message with recovery

## Responsive Behavior

### Desktop (>768px)
- Full neumorphic design
- 800px max width container
- All features visible

### Mobile (<768px)
- Full-screen chat interface
- Simplified neumorphic effects
- Touch-optimized controls
- Hidden context indicator (tap to show)

## Accessibility Features

### Keyboard Navigation
- Tab through all interactive elements
- Enter to send message
- Escape to clear input
- Arrow keys for message history (future)

### Screen Reader Support
- ARIA labels on all controls
- Status announcements
- Message role identification
- Tool usage descriptions

### Visual Accessibility
- High contrast between text and background
- Clear focus indicators
- Sufficient touch target sizes (44x44px minimum)
- No reliance on color alone for information

## Performance Considerations

### Optimizations
- **Token Buffering**: Batch updates every 100ms
- **DOM Updates**: Minimal reflows via HTMX swap strategies
- **Asset Loading**: CSS/JS minified and cached
- **Image Optimization**: SVG icons, no heavy images

### Target Metrics
- **Time to Interactive**: <2 seconds
- **First Token Latency**: <500ms
- **Streaming Rate**: 1-2 tokens/second
- **DOM Update Frequency**: Max 10/second

## Error Handling

### Connection Errors
- Clear message: "Connection lost. Reconnecting..."
- Automatic reconnection with exponential backoff
- Manual reconnect button after 3 attempts

### Generation Errors
- User-friendly error messages
- Retry option with same input
- Suggestion to try with different parameters

### Rate Limiting
- Show remaining cooldown time
- Queue messages if possible
- Clear communication about limits

## Future Enhancements (Not Implemented)

- Chat history sidebar
- Message editing and regeneration
- Conversation export
- Theme customization
- Voice input/output
- Multi-language support
- Collaborative sessions
- Custom tool configuration

## Testing Checklist

- [ ] System greeting appears on load
- [ ] Thinking toggle works correctly
- [ ] Messages send and appear immediately
- [ ] Responses stream smoothly
- [ ] Follow-up suggestions are clickable
- [ ] Tool usage displays properly
- [ ] Status indicators update correctly
- [ ] Context bar shows accurate usage
- [ ] Markdown renders correctly
- [ ] Mobile layout is responsive
- [ ] Keyboard navigation works
- [ ] Error states handle gracefully